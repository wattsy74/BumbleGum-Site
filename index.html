<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Professional RGB guitar controllers for Clone Hero and rhythm gaming. Features ultra-responsive switches, customizable LED effects, and the BumbleGum Configurator app." />
  <meta name="keywords" content="guitar controller, Clone Hero, RGB lighting, gaming hardware, rhythm games, custom controllers" />
  <title>BumbleGum | Professional RGB Guitar Controllers & Configurator App</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Version: 2025-08-13-v2 - Fixed preset browser updateSelectedCount issue -->
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #1a1a1a, #0f0f0f);
      color: #fff;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    header {
      text-align: center;
      padding: 3rem 2rem;
      background: rgba(0, 0, 0, 0.5);
    }
    
    .title-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      margin-bottom: 0.5rem;
      line-height: 1;
    }
    
    .bee-logo {
      width: 67px;
      height: 67px;
      filter: drop-shadow(0 0 8px rgba(255, 204, 0, 0.4));
      transition: transform 0.3s ease, filter 0.3s ease;
      align-self: center;
    }
    
    .bee-logo:hover {
      transform: rotate(10deg) scale(1.1);
      filter: drop-shadow(0 0 12px rgba(255, 204, 0, 0.6));
    }
    
    h1 {
      font-size: 3.5rem;
      margin: 0;
      color: #ffcc00;
      text-shadow: 0 0 20px rgba(255, 204, 0, 0.3);
      font-weight: bold;
    }
    
    .tagline {
      font-size: 1.3rem;
      color: #ccc;
      margin-top: 1rem;
    }
    
    .section {
      padding: 2rem 1.5rem;
      max-width: 1000px;
      margin: 1.5rem auto;
      background: rgba(25, 25, 25, 0.6);
      border-radius: 8px;
      border: 1px solid #333;
    }
    
    .section h2 {
      color: #ffcc00;
      border-bottom: 2px solid #ffcc00;
      padding-bottom: 0.3rem;
      margin-bottom: 1rem;
      font-size: 1.6rem;
      text-shadow: 0 0 10px rgba(255, 204, 0, 0.2);
    }
    
    .gallery img {
      width: 100%;
      max-width: 500px;
      margin: 2rem auto;
      display: block;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      border: 2px solid #333;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .gallery img:hover {
      transform: scale(1.02);
      box-shadow: 0 0 20px rgba(255, 204, 0, 0.3);
    }
    
    .button {
      display: inline-block;
      margin: 1.5rem 0.5rem;
      padding: 12px 24px;
      background: #ffcc00;
      color: #000;
      text-decoration: none;
      border-radius: 999px;
      font-weight: bold;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 204, 0, 0.3);
      border: none;
      cursor: pointer;
    }
    
    .button:hover {
      background: #e6b800;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 204, 0, 0.4);
    }
    
    .button.secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 2px solid #ffcc00;
    }
    
    .button.secondary:hover {
      background: rgba(255, 204, 0, 0.1);
      border-color: #e6b800;
    }
    
    iframe {
      width: 100%;
      height: 400px;
      border: none;
      margin-top: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    }
    
    footer {
      text-align: center;
      padding: 3rem 2rem;
      font-size: 0.9rem;
      background: rgba(0, 0, 0, 0.8);
      color: #ccc;
      border-top: 1px solid #333;
      margin-top: 2rem;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }
    
    .feature-card {
      background: rgba(15, 15, 15, 0.7);
      padding: 1.5rem;
      border-radius: 8px;
      border: 1px solid #333;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(255, 204, 0, 0.1);
    }
    
    .feature-card h3 {
      color: #ffcc00;
      margin-bottom: 1rem;
      font-size: 1.4rem;
    }
    
    .emoji {
      font-size: 2rem;
      margin-bottom: 0.8rem;
      display: block;
    }
    
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    
    .controller-item {
      background: rgba(15, 15, 15, 0.7);
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #333;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
    }
    
    .controller-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 204, 0, 0.1);
    }
    
    .controller-media {
      position: relative;
      width: 100%;
      max-width: 200px;
      margin: 0 auto 0.8rem auto;
    }
    
    .controller-item img {
      width: 100%;
      border-radius: 6px;
      border: 1px solid #444;
      transition: opacity 0.3s ease;
    }
    
    .controller-item video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #444;
      background: #000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .controller-item:hover img {
      opacity: 0;
    }
    
    .controller-item:hover video {
      opacity: 1;
    }
    
    .controller-item h3 {
      color: #ffcc00;
      margin: 0.8rem 0;
      font-size: 1.1rem;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      h1 {
        font-size: 2.5rem;
      }
      
      .section {
        margin: 1rem;
        padding: 2rem 1rem;
      }
      
      .features-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="title-container">
    <img src="bee-logo.png" alt="BumbleGum Bee Logo" class="bee-logo">
    <h1>BumbleGum</h1>
  </div>
  <!-- Preset Format Modal -->
  <div id="preset-format-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:#181818; color:#fff; border-radius:10px; max-width:800px; width:90vw; margin:auto; padding:1.2rem 2rem; border:2px solid #ffcc00;">
      <h3 style="color:#ffcc00; margin-bottom:1rem;">Preset File Format</h3>
      <p style="margin-bottom:1rem;">Your preset file should be a <b>.bgp</b> file containing valid JSON. Example:</p>
      <div id="preset-format-json"></div>
      <button onclick="document.getElementById('preset-format-modal').style.display='none'" style="background:#ffcc00; color:#181818; border:none; border-radius:6px; padding:0.5rem 1.5rem; font-weight:bold; cursor:pointer;">Close</button>
    </div>
  </div>
  <p class="tagline">Professional Guitar Controllers with RGB Soul</p>   
</header>

<section class="section">
  <h2>🎸 Controller Gallery</h2>
  <p>Explore our custom-themed guitar controllers, each with unique designs and RGB patterns.</p>
  
  <div class="gallery-grid">
    <div class="controller-item">
      <div class="controller-media">
        <img src="Aerosmith-Flat.png" alt="Aerosmith Themed Controller">
        <video muted loop>
          <source src="Aerosmith.mp4" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
      <h3>Aerosmith Edition</h3>
    </div>
    
    <div class="controller-item">
      <div class="controller-media">
        <img src="BumbleBee-Flat.png" alt="BumbleBee Themed Controller">
        <video muted loop>
          <source src="BumbleBee.mp4" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
      <h3>BumbleBee Edition</h3>
    </div>
    
    <div class="controller-item">
      <div class="controller-media">
        <img src="Metallica-Flat.png" alt="Metallica Themed Controller">
        <video muted loop>
          <source src="Metallica.mp4" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
      <h3>Metallica Edition</h3>
    </div>
    
    <div class="controller-item">
      <div class="controller-media">
        <img src="WOR-Flat.png" alt="Warriors of Rock Themed Controller">
        <video muted loop>
          <source src="WOR.mp4" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
      <h3>Warriors of Rock Edition</h3>
    </div>
  </div>
  
  <div style="text-align: center; margin-top: 2rem;">
    <a class="button" href="https://www.etsy.com/uk/shop/BumbleGumDesign" target="_blank">Shop on Etsy</a>
  </div>
</section>

<section class="section">
  <h2>🎸 Featured Controllers</h2>
  <p>Discover our handcrafted, RGB-powered guitar controllers designed for Clone Hero, Festival, and professional gaming. Each controller features premium components and stunning LED effects.</p>
  
  <div class="features-grid">
    <div class="feature-card">
      <span class="emoji">⚡</span>
      <h3>Ultra-Responsive</h3>
      <p>1ms input latency with mechanical switches for competitive gaming</p>
    </div>
    <div class="feature-card">
      <span class="emoji">🌈</span>
      <h3>RGB Lighting</h3>
      <p>Customizable LED effects with dynamic patterns and color themes</p>
    </div>
    <div class="feature-card">
      <span class="emoji">🔧</span>
      <h3>Fully Configurable</h3>
      <p>Complete control over button mapping, sensitivity, and visual effects</p>
    </div>
  </div>
</section>

<section class="section" id="configurator">
  <h2>🛠️ BumbleGum Configurator</h2>
  <p>Take complete control of your guitar controller with our professional configuration software. Preview LED effects, customize button layouts, and sync your setup perfectly.</p>
  
  <div class="features-grid">
    <div class="feature-card">
      <span class="emoji">🎛️</span>
      <h3>Real-Time Preview</h3>
      <p>See your LED effects and settings changes instantly</p>
    </div>
    <div class="feature-card">
      <span class="emoji">🔄</span>
      <h3>Auto-Updates</h3>
      <p>Firmware and app updates delivered automatically</p>
    </div>
    <div class="feature-card">
      <span class="emoji">💾</span>
      <h3>Preset Management</h3>
      <p>Save and switch between multiple controller configurations</p>
    </div>
  </div>
  
  <div style="text-align: center; margin-top: 2rem;">
    <a class="button" href="https://github.com/wattsy74/BumbleGum-Guitars-Configurator/releases/latest/download/BumbleGum-Guitars-Configurator.exe" target="_blank">Download for Windows</a>
    <p style="margin-top: 1rem; color: #ccc; font-size: 0.9rem;">
      ✅ Portable - No installation required<br>
      ✅ Windows 10/11 compatible<br>
      ✅ Automatic updates included
    </p>
  </div>
</section>

<section class="section">
  <h2>🎨 Community Presets</h2>
  <p>Share and discover amazing LED patterns and lighting effects created by the BumbleGum community. Download presets, upload your own creations, and showcase your unique controller lighting.</p>
  
  <div class="features-grid">
    <div class="feature-card">
      <span class="emoji">�</span>
      <h3>Browse LED Patterns</h3>
      <p>Explore hundreds of community-created lighting effects and color patterns</p>
    </div>
    <div class="feature-card">
      <span class="emoji">⬆️</span>
      <h3>Share Your Effects</h3>
      <p>Upload your custom LED patterns and let others experience your unique lighting</p>
    </div>
    <div class="feature-card">
      <span class="emoji">⭐</span>
      <h3>Rate & Review</h3>
      <p>Help the community discover the best LED effects with ratings and feedback</p>
    </div>
  </div>
  
  <div style="text-align: center; margin-top: 2rem;">
  <a class="button" href="#preset-browser" onclick="showPresetBrowser()">Browse Presets</a>
  <a class="button secondary" href="#upload-preset" onclick="showUploadForm()">Upload Preset</a>
  </div>
  
  <div id="preset-browser" style="display: none; margin-top: 2rem; padding: 2rem; background: rgba(15, 15, 15, 0.8); border-radius: 8px; border: 1px solid #333;">
    <h3 style="color: #ffcc00; margin-bottom: 1rem;">Interactive Preset Browser</h3>
    <p style="color: #ccc; margin-bottom: 1.5rem;">Preview colors and select presets to create your custom collection</p>
    
    <div id="preset-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
      <!-- Presets will be loaded here -->
    </div>
    
    <div id="selected-presets" style="margin-bottom: 2rem;">
      <h4 style="color: #ffcc00; margin-bottom: 1rem;">Selected Presets (<span id="selected-count">0</span>)</h4>
      <div id="selected-list" style="background: rgba(0, 0, 0, 0.3); border-radius: 4px; padding: 1rem; min-height: 50px; border: 1px solid #444;">
        <p style="color: #888; margin: 0;">No presets selected</p>
      </div>
    </div>
    
    <div style="text-align: center;">
      <button class="button" onclick="exportSelectedPresets()" id="export-btn" disabled>Export Selected Presets</button>
      <button class="button secondary" onclick="hidePresetBrowser()">Close Browser</button>
      <button class="button secondary" onclick="selectAllPresets()">Select All</button>
      <button class="button secondary" onclick="clearSelection()">Clear Selection</button>
    </div>
  </div>
  
  <div id="upload-form" style="display: none; margin-top: 2rem; padding: 2rem; background: rgba(15, 15, 15, 0.8); border-radius: 8px; border: 1px solid #333;">
    <h3 style="color: #ffcc00; margin-bottom: 1rem;">Upload Your Preset</h3>
    <div style="margin-bottom: 1rem;">
      <span style="color: #ffcc00; font-weight: bold; cursor: pointer; text-decoration: underline;" onclick="showPresetFormatModal()">How should my preset file be formatted?</span>
    </div>
    <form id="preset-upload-form">
      <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; color: #ccc;">Preset Name:</label>
        <input type="text" id="preset-name" required style="width: 100%; padding: 0.5rem; background: #222; border: 1px solid #444; color: #fff; border-radius: 4px;">
      </div>
      <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; color: #ccc;">Description:</label>
        <textarea id="preset-description" rows="3" style="width: 100%; padding: 0.5rem; background: #222; border: 1px solid #444; color: #fff; border-radius: 4px;" placeholder="Describe your LED pattern (e.g., 'Blue flame effect with pulsing')"></textarea>
      </div>
      <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; color: #ccc;">Preset File (.bgp):</label>
        <input type="file" id="preset-file" accept=".bgp,.json" style="width: 100%; padding: 0.5rem; background: #222; border: 1px solid #444; color: #fff; border-radius: 4px;">
      </div>
      <div style="text-align: center;">
        <button type="submit" class="button" style="margin-right: 1rem;">Submit to GitHub</button>
        <button type="button" class="button secondary" onclick="hideUploadForm()">Cancel</button>
      </div>
    </form>
  </div>
  
  <div style="text-align: center; margin-top: 1rem;">
    <p style="color: #ccc; font-size: 0.9rem;">
      🚀 Presets are stored on GitHub - Open source community sharing!<br>
      <a href="https://github.com/wattsy74/BumbleGum-Presets" target="_blank" style="color: #ffcc00;">View repository</a> | 
      <a href="https://github.com/wattsy74/BumbleGum-Presets/issues" target="_blank" style="color: #ffcc00;">Report issues</a>
    </p>
  </div>
</section>

<section class="section">
  <h2>🎬 See It In Action</h2>
  <p>Watch the BumbleGum Configurator in action and see how it transforms your gaming experience with real-time LED effects and professional-grade customization.</p>
  <iframe src="https://www.youtube.com/embed/jIEQNqac__8" allowfullscreen title="BumbleGum Configurator Demo - RGB Guitar Controller Setup"></iframe>
</section>

<footer>
  <p>&copy; 2025 BumbleGum Design | Crafted with passion for rhythm gaming</p>
  <p style="margin-top: 0.5rem; font-size: 0.8rem; opacity: 0.8;">
    Professional guitar controllers • RGB lighting systems • Custom gaming hardware
  </p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get all controller items
  const controllerItems = document.querySelectorAll('.controller-item');
  
  controllerItems.forEach(item => {
    const video = item.querySelector('video');
    
    if (video) {
      // Pause video initially
      video.pause();
      
      // Add hover event listeners
      item.addEventListener('mouseenter', function() {
        video.currentTime = 0; // Reset to beginning
        video.play();
      });
      
      item.addEventListener('mouseleave', function() {
        video.pause();
        video.currentTime = 0; // Reset to beginning for next hover
      });
    }
  });
});
 
 function showPresetFormatModal() {
   document.getElementById('preset-format-modal').style.display = 'flex';
   document.getElementById('preset-format-json').innerHTML = `<pre style="background:#222; color:#ffcc00; padding:1rem; border-radius:6px; font-size:0.95em; margin-bottom:1rem;">{
   \"name\": \"My Custom Preset\",
   \"author\": \"Your Name\",
   \"description\": \"Describe your LED effect\",
   \"version\": \"1.0\",
   \"created\": \"2025-08-14\",
   \"preset\": {
     \"green-fret-pressed\": \"#00FF00\",
     \"red-fret-pressed\": \"#FF0000\",
     \"yellow-fret-pressed\": \"#FFFF00\",
     \"blue-fret-pressed\": \"#0000FF\",
     \"orange-fret-pressed\": \"#FF4D00\",
     \"green-fret-released\": \"#008000\",
     \"red-fret-released\": \"#800000\",
     \"yellow-fret-released\": \"#808000\",
     \"blue-fret-released\": \"#000080\",
     \"orange-fret-released\": \"#804000\",
     \"strum-up-active\": \"#FFFFFF\",
     \"strum-down-active\": \"#FFFFFF\",
     \"strum-up-released\": \"#808080\",
     \"strum-down-released\": \"#808080\"
   }
 }`;
 }

// GitHub Preset Sharing Functions
function showUploadForm() {
  document.getElementById('upload-form').style.display = 'block';
  document.getElementById('preset-browser').style.display = 'none';
  document.getElementById('upload-form').scrollIntoView({ behavior: 'smooth' });
}

function hideUploadForm() {
  document.getElementById('upload-form').style.display = 'none';
}

function showPresetBrowser() {
  console.log('Opening preset browser...');
  document.getElementById('preset-browser').style.display = 'block';
  document.getElementById('upload-form').style.display = 'none';
  document.getElementById('preset-browser').scrollIntoView({ behavior: 'smooth' });
  console.log('About to call loadCommunityPresets...');
  loadCommunityPresets();
}

function hidePresetBrowser() {
  document.getElementById('preset-browser').style.display = 'none';
}

// Preset Browser Functionality
let communityPresets = [];
let selectedPresets = new Set();

async function loadCommunityPresets() {
  console.log('loadCommunityPresets function called');
  const presetGrid = document.getElementById('preset-grid');
  
  if (!presetGrid) {
    console.error('preset-grid element not found!');
    return;
  }
  
  console.log('preset-grid element found:', presetGrid);
  presetGrid.innerHTML = '<p style="color: #ccc;">Loading community presets...</p>';
  
  try {
    console.log('Fetching presets from GitHub API...');
    
    // Fetch preset files from GitHub API
    const response = await fetch('https://api.github.com/repos/wattsy74/BumbleGum-Presets/contents/presets');
    
    if (!response.ok) {
      throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
    }
    
    const files = await response.json();
    console.log('Found files:', files);
    
    communityPresets = [];
    
    // Filter for .bgp files
    const bgpFiles = files.filter(file => file.name.endsWith('.bgp'));
    console.log('BGP files:', bgpFiles);
    
    if (bgpFiles.length === 0) {
      presetGrid.innerHTML = '<p style="color: #ff4444;">No .bgp preset files found in repository.</p>';
      return;
    }
    
    for (const file of bgpFiles) {
      try {
        console.log(`Loading preset: ${file.name}`);
        
        // Use raw.githubusercontent.com for direct file access
        const presetUrl = `https://raw.githubusercontent.com/wattsy74/BumbleGum-Presets/main/presets/${file.name}`;
        const presetResponse = await fetch(presetUrl);
        
        if (!presetResponse.ok) {
          console.error(`Failed to fetch ${file.name}: ${presetResponse.status}`);
          continue;
        }
        
        const presetText = await presetResponse.text();
        console.log(`Raw content for ${file.name}:`, presetText);
        
        const presetData = JSON.parse(presetText);
        console.log(`Parsed data for ${file.name}:`, presetData);
        
        // Validate required fields
        if (!presetData.name || !presetData.preset) {
          console.error(`Invalid preset format in ${file.name}`);
          continue;
        }
        
        communityPresets.push({
          id: file.name.replace('.bgp', ''),
          name: presetData.name,
          author: presetData.author || 'Unknown',
          description: presetData.description || 'No description',
          preset: presetData.preset
        });
        
      } catch (error) {
        console.error(`Failed to load preset ${file.name}:`, error);
      }
    }
    
    console.log('Final community presets:', communityPresets);
    
    if (communityPresets.length === 0) {
      presetGrid.innerHTML = '<p style="color: #ff4444;">Failed to load any valid presets. Check browser console for details.</p>';
      return;
    }
    
    // Make sure to render the grid after loading
    renderPresetGrid();
    updateSelectedPresets();
    
  } catch (error) {
    console.error('Failed to load community presets:', error);
    presetGrid.innerHTML = `
      <p style="color: #ff4444;">Failed to load presets: ${error.message}</p>
      <p style="color: #ccc; font-size: 0.9rem;">
        This could be due to network issues or GitHub API limits. 
        <a href="https://github.com/wattsy74/BumbleGum-Presets" target="_blank" style="color: #ffcc00;">
          View presets on GitHub
        </a>
      </p>
    `;
  }
}

function renderPresetGrid() {
  const presetGrid = document.getElementById('preset-grid');
  
  console.log('Rendering preset grid with', communityPresets.length, 'presets');
  
  if (communityPresets.length === 0) {
    presetGrid.innerHTML = '<p style="color: #ccc;">No community presets found.</p>';
    return;
  }
  
  try {
    const presetCards = communityPresets.map(preset => {
      console.log('Rendering preset:', preset);
      
      // Safely get colors with fallbacks
      const colors = preset.preset || {};
      const getColor = (key, fallback = '#666666') => colors[key] || fallback;
      
      return `
        <div class="preset-card" data-preset-id="${preset.id}" style="
          background: rgba(25, 25, 25, 0.8); 
          border: 2px solid ${selectedPresets.has(preset.id) ? '#ffcc00' : '#444'}; 
          border-radius: 8px; 
          padding: 1rem; 
          cursor: pointer;
          transition: all 0.3s ease;
        " onclick="togglePresetSelection('${preset.id}')">
          <h4 style="color: #ffcc00; margin-bottom: 0.5rem;">${preset.name}</h4>
          <p style="color: #ccc; font-size: 0.9rem; margin-bottom: 1rem;">${preset.description}</p>
          <p style="color: #888; font-size: 0.8rem; margin-bottom: 1rem;">by ${preset.author}</p>
          
          <div style="margin-bottom: 1rem;">
            <h5 style="color: #ffcc00; font-size: 0.9rem; margin-bottom: 0.5rem; text-align: center;">Fret Button Colors</h5>
            <div class="color-preview" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 1rem;">
              <div class="fret-preview" style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; color: #888; margin-bottom: 3px;">Green</span>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Released</span>
                <div style="width: 40px; height: 30px; background: ${getColor('green-fret-released', '#008000')}; border-radius: 4px; margin-bottom: 4px; border: 1px solid #333;"></div>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Pressed</span>
                <div style="width: 40px; height: 30px; background: ${getColor('green-fret-pressed', '#00FF00')}; border-radius: 6px; border: 1px solid #333;"></div>
              </div>
              <div class="fret-preview" style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; color: #888; margin-bottom: 3px;">Red</span>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Released</span>
                <div style="width: 40px; height: 30px; background: ${getColor('red-fret-released', '#800000')}; border-radius: 4px; margin-bottom: 4px; border: 1px solid #333;"></div>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Pressed</span>
                <div style="width: 40px; height: 30px; background: ${getColor('red-fret-pressed', '#FF0000')}; border-radius: 6px; border: 1px solid #333;"></div>
              </div>
              <div class="fret-preview" style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; color: #888; margin-bottom: 3px;">Yellow</span>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Released</span>
                <div style="width: 40px; height: 30px; background: ${getColor('yellow-fret-released', '#808000')}; border-radius: 4px; margin-bottom: 4px; border: 1px solid #333;"></div>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Pressed</span>
                <div style="width: 40px; height: 30px; background: ${getColor('yellow-fret-pressed', '#FFFF00')}; border-radius: 6px; border: 1px solid #333;"></div>
              </div>
              <div class="fret-preview" style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; color: #888; margin-bottom: 3px;">Blue</span>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Released</span>
                <div style="width: 40px; height: 30px; background: ${getColor('blue-fret-released', '#000080')}; border-radius: 4px; margin-bottom: 4px; border: 1px solid #333;"></div>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Pressed</span>
                <div style="width: 40px; height: 30px; background: ${getColor('blue-fret-pressed', '#0000FF')}; border-radius: 6px; border: 1px solid #333;"></div>
              </div>
              <div class="fret-preview" style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; color: #888; margin-bottom: 3px;">Orange</span>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Released</span>
                <div style="width: 40px; height: 30px; background: ${getColor('orange-fret-released', '#804000')}; border-radius: 4px; margin-bottom: 4px; border: 1px solid #333;"></div>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Pressed</span>
                <div style="width: 40px; height: 30px; background: ${getColor('orange-fret-pressed', '#FF4D00')}; border-radius: 6px; border: 1px solid #333;"></div>
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <h5 style="color: #ffcc00; font-size: 0.9rem; margin-bottom: 0.5rem; text-align: center;">Strum Bar Colors</h5>
            <div class="strum-preview" style="display: flex; justify-content: center; gap: 16px;">
              <div style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; color: #888; margin-bottom: 3px;">Strum Up</span>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Released</span>
                <div style="width: 60px; height: 20px; background: ${getColor('strum-up-released', '#808080')}; border-radius: 4px; margin-bottom: 4px; border: 1px solid #333;"></div>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Active</span>
                <div style="width: 60px; height: 20px; background: ${getColor('strum-up-active', '#FFFFFF')}; border-radius: 4px; border: 1px solid #333;"></div>
              </div>
              <div style="display: flex; flex-direction: column; align-items: center;">
                <span style="font-size: 0.7rem; color: #888; margin-bottom: 3px;">Strum Down</span>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Released</span>
                <div style="width: 60px; height: 20px; background: ${getColor('strum-down-released', '#808080')}; border-radius: 4px; margin-bottom: 4px; border: 1px solid #333;"></div>
                <span style="font-size: 0.6rem; color: #aaa; margin-bottom: 2px;">Active</span>
                <div style="width: 60px; height: 20px; background: ${getColor('strum-down-active', '#FFFFFF')}; border-radius: 4px; border: 1px solid #333;"></div>
              </div>
            </div>
          </div>
          
          <div style="text-align: center; margin-top: 1rem;">
            <span style="color: ${selectedPresets.has(preset.id) ? '#ffcc00' : '#888'}; font-weight: bold;">
              ${selectedPresets.has(preset.id) ? '✅ Selected' : 'Click to select'}
            </span>
          </div>
        </div>
      `;
    });
    
    presetGrid.innerHTML = presetCards.join('');
    console.log('Preset grid rendered successfully');
    
  } catch (error) {
    console.error('Error rendering preset grid:', error);
    presetGrid.innerHTML = `<p style="color: #ff4444;">Error rendering presets: ${error.message}</p>`;
  }
}

function updateSelectedCount() {
  const selectedCount = selectedPresets.size;
  const selectedCountElement = document.querySelector('#preset-browser h3');
  if (selectedCountElement) {
    selectedCountElement.textContent = `Selected Presets (${selectedCount})`;
  }
}

function togglePresetSelection(presetId) {
  if (selectedPresets.has(presetId)) {
    selectedPresets.delete(presetId);
  } else {
    selectedPresets.add(presetId);
  }
  
  updateSelectedPresets();
  renderPresetGrid();
}

function selectAllPresets() {
  selectedPresets = new Set(communityPresets.map(p => p.id));
  updateSelectedPresets();
  renderPresetGrid();
}

function clearSelection() {
  selectedPresets.clear();
  updateSelectedPresets();
  renderPresetGrid();
}

function updateSelectedPresets() {
  const selectedCount = document.getElementById('selected-count');
  const selectedList = document.getElementById('selected-list');
  const exportBtn = document.getElementById('export-btn');
  
  selectedCount.textContent = selectedPresets.size;
  
  if (selectedPresets.size === 0) {
    selectedList.innerHTML = '<p style="color: #888; margin: 0;">No presets selected</p>';
    exportBtn.disabled = true;
  } else {
    const selectedNames = communityPresets
      .filter(p => selectedPresets.has(p.id))
      .map(p => `<span style="color: #ffcc00;">${p.name}</span>`)
      .join(', ');
    selectedList.innerHTML = `<p style="margin: 0;">${selectedNames}</p>`;
    exportBtn.disabled = false;
  }
}

function exportSelectedPresets() {
  if (selectedPresets.size === 0) {
    alert('Please select at least one preset to export.');
    return;
  }
  
  const selectedPresetData = {};
  
  communityPresets
    .filter(p => selectedPresets.has(p.id))
    .forEach(preset => {
      selectedPresetData[`Community - ${preset.name}`] = preset.preset;
    });
  
  const exportData = {
    "_metadata": {
      "version": "3.9.26",
      "description": "BumbleGum Guitar Controller Presets - Community Selection",
      "lastUpdated": new Date().toISOString().split('T')[0],
      "exportedFrom": "BumbleGum Website",
      "communityPresets": selectedPresets.size
    },
    "presets": selectedPresetData
  };
  
  const jsonString = JSON.stringify(exportData, null, 2);
  const blob = new Blob([jsonString], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `bumblegum-community-presets-${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  alert(`Exported ${selectedPresets.size} presets! Import this file in the BumbleGum Configurator.`);
}

// Handle preset upload form submission
document.addEventListener('DOMContentLoaded', function() {
  const uploadForm = document.getElementById('preset-upload-form');
  if (uploadForm) {
    uploadForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const name = document.getElementById('preset-name').value;
      const description = document.getElementById('preset-description').value;
      const fileInput = document.getElementById('preset-file');
      
      if (!fileInput.files[0]) {
        alert('Please select a preset file to upload.');
        return;
      }
      
      try {
        await uploadPresetToGitHub(name, description, fileInput.files[0]);
        alert('Preset uploaded successfully! It will appear in the repository shortly.');
        hideUploadForm();
        uploadForm.reset();
      } catch (error) {
        console.error('Upload error:', error);
        alert('Upload failed. Please try again or submit manually to the GitHub repository.');
      }
    });
  }
});

async function uploadPresetToGitHub(name, description, file) {
  // This would require a GitHub token and backend service
  // For now, we'll redirect to GitHub's file upload interface
  const repoUrl = 'https://github.com/wattsy74/BumbleGum-Presets';
  const uploadUrl = `${repoUrl}/upload/main/presets`;
  
  // Create a detailed preset info
  const presetInfo = {
    name: name,
    description: description,
    uploadDate: new Date().toISOString(),
    fileName: file.name
  };
  
  // For now, open GitHub upload page
  window.open(uploadUrl, '_blank');
  
  // TODO: Implement actual GitHub API integration with:
  // - GitHub Personal Access Token (stored securely)
  // - File upload via GitHub Contents API
  // - Automatic PR creation for community review
}

// Load community presets when browser is opened
document.addEventListener('DOMContentLoaded', function() {
  if (document.getElementById('preset-browser').style.display !== 'none') {
    loadCommunityPresets();
  }
});

</script>

</body>
</html>